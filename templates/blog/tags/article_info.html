{% load blog_tags %}
{% load cache %}
{% load i18n %}
{% load static %}
<article id="post-{{ article.pk }} "
         class="post-{{ article.pk }} post type-post status-publish format-standard hentry{% if isindex %} list-page{% endif %}">
    <header class="entry-header">

        <h1 class="entry-title">
            {% if  isindex %}
                {# Explicitly generate list page title with link #}
                {% if article.is_premium %}
                <span style="float: right; color: red;font-size: 0.6em;pointer-events: none;"> [宗内秘要]</span>
                
                {% endif %}

                <a href="{{ article.get_absolute_url }}"
                   rel="bookmark">{{ article.title }}</a>

            {% else %}
                {# Display title with link and premium tag for detail page #}
                <a href="{{ article.get_absolute_url }}"
                   rel="bookmark">{{ article.title }}</a>
            {% endif %}
        </h1>
        <div class="comments-link">
            {% if article.comment_status == "o" and open_site_comment %}
                <a href="{{ article.get_absolute_url }}#comments" class="ds-thread-count" data-thread-key="3815"
                   rel="nofollow">
                    <span class="leave-reply">
                    {% if article.comment_set and article.comment_set.count %}
                        {{ article.comment_set.count }} {% trans 'comments' %}
                    {% else %}
                        {% trans 'comment' %}
                    {% endif %}
                    </span>
                </a>
            {% endif %}
        </div><!-- .comments-link -->
        <br/>
        {% if article.type == 'a' %}
            {% if not isindex %}
                {% cache 36000 breadcrumb article.pk %}
                    {% load_breadcrumb article %}
                {% endcache %}
            {% endif %}
        {% endif %}
    </header><!-- .entry-header -->

    <div class="entry-content" itemprop="articleBody">
        {# Render the main article text body (including videos) #}
        <div class="article">
            {% if not isindex and article.show_toc %}
                {% get_markdown_toc article.body as toc %}
                <b>{% trans 'toc' %}:</b>
                {{ toc|safe }}

                <hr class="break_line"/>
            {% endif %}
            {{ processed_article_text_body }}
        </div>

        {# Wrap the images in a separate media gallery #}
        {% if processed_article_media_elements %}
            <div class="article-media-gallery{% if isindex %} gallery-two-col{% endif %}" data-is-index="{{ isindex|yesno:'true,false' }}">
                {% for media_element in processed_article_media_elements %}
                    {{ media_element|safe }}
                {% endfor %}
            </div> {# End article-media-gallery #}
        {% endif %}

        {# Load more images button only for detail page #}
        {% if not isindex %}
            <div id="paginated-images-container"></div>
            <button id="load-more-images" class="btn btn-primary mt-3" data-article-id="{{ article.id }}" data-page-num="1" style="display: none;">加载更多图片</button>
        {% endif %}

        {% if isindex %}
             {# Place read more link after the gallery for list view #}
             <p class='read-more'><a
                    href=' {{ article.get_absolute_url }}'>Read more</a></p>
        {% endif %}

    </div><!-- .entry-content -->

    {% load_article_metas article user %}

    {# Add the script for media gallery layout #}
    <script src="{% static 'blog/js/article_media_layout.js' %}"></script>

</article><!-- #post -->